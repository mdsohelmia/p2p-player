<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>TenbyteLive Player - P2P</title>
        <link rel="stylesheet" href="player.css" />
        <!-- HLS.js and SwarmCloud P2P Engine (separate scripts) -->
        <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
        <script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls@latest/p2p-engine.min.js"></script>
    </head>
    <body>
        <div class="player-wrapper">
            <div class="video-container" id="videoContainer">
                <video id="video" playsinline></video>

                <!-- Loading Spinner -->
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <div class="loading-status" id="loadingStatus"></div>
                </div>

                <!-- Big Play Button -->
                <button class="big-play" id="bigPlayBtn" onclick="togglePlay()">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z" /></svg>
                </button>

                <!-- Error Overlay -->
                <div class="error-overlay" id="errorOverlay">
                    <svg class="error-icon" viewBox="0 0 24 24">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                        />
                    </svg>
                    <div class="error-message" id="errorMessage">
                        Stream unavailable
                    </div>
                    <button class="error-retry" onclick="retryStream()">
                        Retry
                    </button>
                </div>

                <!-- Debug Bar -->
                <div class="debug-bar" id="debugBar">
                    <div class="debug-header">
                        <span class="debug-title">P2P Debug Console</span>
                        <div class="debug-controls">
                            <button
                                class="debug-btn"
                                onclick="clearDebugLog()"
                                title="Clear"
                            >
                                Clear
                            </button>
                            <button
                                class="debug-btn"
                                onclick="toggleDebugBar()"
                                title="Close"
                            >
                                X
                            </button>
                        </div>
                    </div>
                    <div class="debug-status">
                        <div class="debug-status-item">
                            <span class="debug-status-label">P2P Engine</span>
                            <span
                                class="debug-status-value"
                                id="debugEngineStatus"
                            >
                                <span class="status-dot"></span>
                                <span class="status-text">Checking...</span>
                            </span>
                        </div>
                        <div class="debug-status-item">
                            <span class="debug-status-label"
                                >Signal Server</span
                            >
                            <span
                                class="debug-status-value"
                                id="debugServerStatus"
                            >
                                <span class="status-dot"></span>
                                <span class="status-text">Disconnected</span>
                            </span>
                        </div>
                        <div class="debug-status-item">
                            <span class="debug-status-label">Peer ID</span>
                            <span class="debug-status-value" id="debugPeerId"
                                >-</span
                            >
                        </div>
                        <div class="debug-status-item">
                            <span class="debug-status-label"
                                >Connected Peers</span
                            >
                            <span class="debug-status-value" id="debugPeerCount"
                                >0</span
                            >
                        </div>
                    </div>
                    <div class="debug-metrics">
                        <div class="debug-metric">
                            <div class="metric-value" id="debugP2PPercent">
                                0%
                            </div>
                            <div class="metric-label">P2P Ratio</div>
                            <div class="metric-bar">
                                <div
                                    class="metric-bar-fill p2p"
                                    id="debugP2PBar"
                                ></div>
                            </div>
                        </div>
                        <div class="debug-metric">
                            <div class="metric-value" id="debugHTTPPercent">
                                0%
                            </div>
                            <div class="metric-label">HTTP Ratio</div>
                            <div class="metric-bar">
                                <div
                                    class="metric-bar-fill http"
                                    id="debugHTTPBar"
                                ></div>
                            </div>
                        </div>
                    </div>
                    <div class="debug-traffic">
                        <div class="traffic-item">
                            <span class="traffic-icon p2p-down"></span>
                            <span class="traffic-label">P2P Down</span>
                            <span class="traffic-value" id="debugP2PDown"
                                >0 KB</span
                            >
                        </div>
                        <div class="traffic-item">
                            <span class="traffic-icon p2p-up"></span>
                            <span class="traffic-label">P2P Up</span>
                            <span class="traffic-value" id="debugP2PUp"
                                >0 KB</span
                            >
                        </div>
                        <div class="traffic-item">
                            <span class="traffic-icon http"></span>
                            <span class="traffic-label">HTTP Down</span>
                            <span class="traffic-value" id="debugHTTPDown"
                                >0 KB</span
                            >
                        </div>
                        <div class="traffic-item saved">
                            <span class="traffic-icon saved"></span>
                            <span class="traffic-label">Saved</span>
                            <span class="traffic-value" id="debugSaved"
                                >0 KB</span
                            >
                        </div>
                    </div>
                    <div class="debug-log-container">
                        <div class="debug-log-header">Activity Log</div>
                        <div class="debug-log" id="debugLog"></div>
                    </div>
                </div>

                <!-- Stats Overlay -->
                <div class="stats-overlay" id="statsOverlay">
                    <div class="stats-section">
                        <div class="stats-section-title">Playback</div>
                        <div class="stats-row">
                            <span class="stats-label">Resolution</span>
                            <span class="stats-value" id="statResolution"
                                >-</span
                            >
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Bitrate</span>
                            <span class="stats-value" id="statBitrate">-</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Buffer</span>
                            <span class="stats-value" id="statBuffer">-</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Dropped</span>
                            <span class="stats-value" id="statDropped">-</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Latency</span>
                            <span class="stats-value" id="statLatency">-</span>
                        </div>
                    </div>
                    <div class="stats-section p2p-stats">
                        <div class="stats-section-title">P2P Network</div>
                        <div class="stats-row">
                            <span class="stats-label">Version</span>
                            <span class="stats-value" id="statP2PVersion"
                                >-</span
                            >
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Peers</span>
                            <span class="stats-value" id="statPeers">-</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">P2P Download</span>
                            <span class="stats-value" id="statP2PDownload"
                                >-</span
                            >
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">P2P Upload</span>
                            <span class="stats-value" id="statP2PUpload"
                                >-</span
                            >
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">HTTP Download</span>
                            <span class="stats-value" id="statHTTPDownload"
                                >-</span
                            >
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">P2P Ratio</span>
                            <span class="stats-value" id="statP2PRatio">-</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Saved Traffic</span>
                            <span class="stats-value" id="statSavedTraffic"
                                >-</span
                            >
                        </div>
                    </div>
                </div>

                <!-- URL Bar -->
                <div class="url-bar">
                    <input
                        type="text"
                        id="streamUrl"
                        value="https://live-cdn.tenbyte.io/streams/demo/master.m3u8"
                        placeholder="Enter stream URL"
                    />
                    <button onclick="loadStream()">Load</button>
                    <span class="p2p-badge" id="p2pBadge" title="P2P CDN">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                            <path
                                fill="currentColor"
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"
                            />
                        </svg>
                        <span id="p2pBadgeText">P2P</span>
                    </span>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <!-- Progress Bar -->
                    <div class="progress-container" id="progressContainer">
                        <div class="buffer-bar" id="bufferBar"></div>
                        <div class="progress-bar" id="progressBar"></div>
                    </div>

                    <!-- Controls Row -->
                    <div class="controls-row">
                        <!-- Play/Pause -->
                        <button class="ctrl-btn" onclick="togglePlay()">
                            <svg id="playIcon" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            <svg
                                id="pauseIcon"
                                viewBox="0 0 24 24"
                                style="display: none"
                            >
                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                            </svg>
                        </button>

                        <!-- Volume -->
                        <div class="volume-control">
                            <button class="ctrl-btn" onclick="toggleMute()">
                                <svg id="volumeIcon" viewBox="0 0 24 24">
                                    <path
                                        d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
                                    />
                                </svg>
                                <svg
                                    id="muteIcon"
                                    viewBox="0 0 24 24"
                                    style="display: none"
                                >
                                    <path
                                        d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"
                                    />
                                </svg>
                            </button>
                            <div class="volume-slider">
                                <input
                                    type="range"
                                    id="volumeSlider"
                                    min="0"
                                    max="100"
                                    value="80"
                                />
                            </div>
                        </div>

                        <!-- Live Badge -->
                        <div
                            class="live-badge"
                            id="liveBadge"
                            onclick="jumpToLive()"
                        >
                            <span class="live-dot"></span>
                            <span>LIVE</span>
                        </div>

                        <div class="spacer"></div>

                        <!-- Quality -->
                        <div class="settings-btn">
                            <button
                                class="ctrl-btn quality-btn"
                                onclick="toggleQualityMenu()"
                            >
                                <span id="currentQuality">Auto</span>
                            </button>
                            <div class="quality-menu" id="qualityMenu">
                                <div class="quality-header">Quality</div>
                                <div id="qualityOptions"></div>
                            </div>
                        </div>

                        <!-- Share -->
                        <button
                            class="ctrl-btn"
                            onclick="copyShareLink()"
                            title="Copy Share Link"
                            id="shareBtn"
                        >
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"
                                />
                            </svg>
                        </button>

                        <!-- Debug -->
                        <button
                            class="ctrl-btn"
                            onclick="toggleDebugBar()"
                            title="P2P Debug (D)"
                            id="debugBtn"
                        >
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"
                                />
                            </svg>
                        </button>

                        <!-- Stats -->
                        <button
                            class="ctrl-btn"
                            onclick="toggleStats()"
                            title="Stats (S)"
                        >
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                                />
                            </svg>
                        </button>

                        <!-- Fullscreen -->
                        <button class="ctrl-btn" onclick="toggleFullscreen()">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"
                                />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            /* P2P Badge Styles */
            .p2p-badge {
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 8px 12px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 6px;
                color: rgba(255, 255, 255, 0.5);
                font-size: 12px;
                font-weight: 600;
                white-space: nowrap;
                transition: all 0.3s ease;
            }

            .p2p-badge.active {
                background: rgba(76, 175, 80, 0.2);
                border-color: rgba(76, 175, 80, 0.5);
                color: #4caf50;
            }

            .p2p-badge.connected {
                background: rgba(33, 150, 243, 0.2);
                border-color: rgba(33, 150, 243, 0.5);
                color: #2196f3;
            }

            /* Extended Stats Overlay for P2P */
            .stats-overlay {
                min-width: 240px;
            }

            .stats-section {
                margin-bottom: 12px;
            }

            .stats-section:last-child {
                margin-bottom: 0;
            }

            .stats-section-title {
                font-size: 11px;
                font-weight: 600;
                color: rgba(255, 255, 255, 0.5);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 8px;
                padding-bottom: 4px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .p2p-stats .stats-value {
                color: #4caf50;
            }

            .p2p-stats .stats-row:first-child .stats-value {
                color: rgba(255, 255, 255, 0.6);
                font-size: 10px;
            }

            /* Debug Bar Styles */
            .debug-bar {
                position: absolute;
                top: 70px;
                right: 20px;
                width: 320px;
                max-height: calc(100% - 160px);
                background: rgba(0, 0, 0, 0.95);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                font-size: 12px;
                font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
                z-index: 100;
                display: none;
                flex-direction: column;
                overflow: hidden;
            }

            .debug-bar.show {
                display: flex;
            }

            .debug-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 12px;
                background: rgba(255, 255, 255, 0.05);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .debug-title {
                font-weight: 600;
                color: #fff;
                font-size: 13px;
            }

            .debug-controls {
                display: flex;
                gap: 8px;
            }

            .debug-btn {
                background: rgba(255, 255, 255, 0.1);
                border: none;
                color: rgba(255, 255, 255, 0.7);
                padding: 4px 8px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 11px;
                transition: all 0.2s;
            }

            .debug-btn:hover {
                background: rgba(255, 255, 255, 0.2);
                color: #fff;
            }

            .debug-status {
                padding: 12px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .debug-status-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 4px 0;
            }

            .debug-status-label {
                color: rgba(255, 255, 255, 0.5);
            }

            .debug-status-value {
                color: #fff;
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .status-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #666;
            }

            .status-dot.success {
                background: #4caf50;
                box-shadow: 0 0 6px #4caf50;
            }

            .status-dot.warning {
                background: #ff9800;
                box-shadow: 0 0 6px #ff9800;
            }

            .status-dot.error {
                background: #f44336;
                box-shadow: 0 0 6px #f44336;
            }

            .debug-metrics {
                display: flex;
                gap: 12px;
                padding: 12px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .debug-metric {
                flex: 1;
                text-align: center;
            }

            .metric-value {
                font-size: 20px;
                font-weight: 700;
                color: #fff;
            }

            .metric-label {
                font-size: 10px;
                color: rgba(255, 255, 255, 0.5);
                text-transform: uppercase;
                margin: 4px 0;
            }

            .metric-bar {
                height: 4px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 2px;
                overflow: hidden;
            }

            .metric-bar-fill {
                height: 100%;
                border-radius: 2px;
                transition: width 0.3s ease;
                width: 0%;
            }

            .metric-bar-fill.p2p {
                background: linear-gradient(90deg, #4caf50, #8bc34a);
            }

            .metric-bar-fill.http {
                background: linear-gradient(90deg, #2196f3, #03a9f4);
            }

            .debug-traffic {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                padding: 12px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .traffic-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 6px 8px;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 4px;
            }

            .traffic-item.saved {
                grid-column: span 2;
                background: rgba(76, 175, 80, 0.1);
                border: 1px solid rgba(76, 175, 80, 0.3);
            }

            .traffic-icon {
                width: 8px;
                height: 8px;
                border-radius: 2px;
            }

            .traffic-icon.p2p-down {
                background: #4caf50;
            }

            .traffic-icon.p2p-up {
                background: #8bc34a;
            }

            .traffic-icon.http {
                background: #2196f3;
            }

            .traffic-icon.saved {
                background: #4caf50;
            }

            .traffic-label {
                flex: 1;
                color: rgba(255, 255, 255, 0.5);
                font-size: 11px;
            }

            .traffic-value {
                color: #fff;
                font-weight: 600;
            }

            .debug-log-container {
                flex: 1;
                min-height: 100px;
                max-height: 200px;
                display: flex;
                flex-direction: column;
            }

            .debug-log-header {
                padding: 8px 12px;
                color: rgba(255, 255, 255, 0.5);
                font-size: 10px;
                text-transform: uppercase;
                background: rgba(255, 255, 255, 0.03);
            }

            .debug-log {
                flex: 1;
                overflow-y: auto;
                padding: 8px 12px;
                font-size: 11px;
                line-height: 1.6;
            }

            .debug-log::-webkit-scrollbar {
                width: 6px;
            }

            .debug-log::-webkit-scrollbar-track {
                background: transparent;
            }

            .debug-log::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
                border-radius: 3px;
            }

            .log-entry {
                padding: 2px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .log-entry:last-child {
                border-bottom: none;
            }

            .log-time {
                color: rgba(255, 255, 255, 0.3);
                margin-right: 8px;
            }

            .log-entry.info .log-msg {
                color: #2196f3;
            }

            .log-entry.success .log-msg {
                color: #4caf50;
            }

            .log-entry.warning .log-msg {
                color: #ff9800;
            }

            .log-entry.error .log-msg {
                color: #f44336;
            }

            .log-entry.p2p .log-msg {
                color: #8bc34a;
            }

            .log-entry.http .log-msg {
                color: #03a9f4;
            }

            /* Debug button active state */
            #debugBtn.active {
                background: rgba(76, 175, 80, 0.2);
                color: #4caf50;
            }
        </style>

        <script src="player-p2p.js"></script>
    </body>
</html>
